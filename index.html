<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Camera &amp; Photo Editor by ritam 
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&amp;family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Roboto', sans-serif;
    }
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
 </head>
 <body class="bg-gray-900 text-white flex flex-col min-h-screen">
  <!-- App Container -->
  <div class="flex flex-col flex-grow" id="app">
   <!-- Camera View -->
   <section aria-label="Camera viewfinder and controls" class="relative flex flex-col flex-grow bg-black" id="camera-view">
    <video aria-label="Real-time camera viewfinder" autoplay="" class="w-full h-full object-cover" id="video" muted="" playsinline="">
    </video>
    <!-- Overlay controls -->
    <div aria-hidden="true" class="absolute inset-0 flex flex-col justify-between p-4 pointer-events-none">
     <!-- Top controls: Flash and zoom indicator -->
     <div class="flex justify-between items-center pointer-events-auto">
      <button aria-label="Toggle flash mode" class="bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="flash-btn" title="Flash: Auto">
       <i class="fas fa-bolt">
       </i>
       <span class="sr-only" id="flash-mode">
        Auto
       </span>
      </button>
      <div class="bg-black bg-opacity-50 rounded-full px-3 py-1 text-sm font-medium pointer-events-none select-none" id="zoom-level">
       1x
      </div>
     </div>
     <!-- Bottom controls: Capture button and mode switch -->
     <div class="flex justify-center items-center space-x-10 pointer-events-auto">
      <button aria-label="Capture photo" class="w-20 h-20 bg-white rounded-full border-8 border-gray-300 hover:border-white focus:outline-none focus:ring-4 focus:ring-indigo-500 active:scale-95 transition-transform" id="capture-btn" title="Capture photo">
      </button>
     </div>
    </div>
   </section>
   <!-- Photo Preview & Editing Section -->
   <section aria-label="Photo preview and editing tools" class="hidden flex-col flex-grow bg-gray-800 overflow-y-auto" id="photo-preview">
    <div class="relative flex justify-center bg-black p-4">
     <img alt="Preview of the captured photo showing a placeholder image of a scenic mountain landscape with a clear blue sky" class="max-h-[60vh] object-contain rounded-md shadow-lg" height="800" id="captured-photo" src="https://storage.googleapis.com/a1aa/image/1e35f571-ea24-491b-060f-566f1b1d1f3b.jpg" width="600"/>
     <button aria-label="Close photo preview and return to camera" class="absolute top-4 right-4 bg-black bg-opacity-60 rounded-full p-2 hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="close-preview" title="Back to camera">
      <i class="fas fa-times text-white text-xl">
      </i>
     </button>
    </div>
    <!-- Editing Tools Tabs -->
    <div class="flex flex-col flex-grow p-4 space-y-4">
     <nav aria-label="Photo editing tools" class="flex space-x-4 overflow-x-auto no-scrollbar border-b border-gray-700 pb-2" id="edit-tabs" role="tablist">
      <button aria-controls="basic-adjustments-panel" aria-selected="true" class="text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-basic" role="tab" tabindex="0">
       Basic Adjustments
      </button>
      <button aria-controls="filters-panel" aria-selected="false" class="text-gray-400 hover:text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-filters" role="tab" tabindex="-1">
       Filters
      </button>
      <button aria-controls="crop-rotate-panel" aria-selected="false" class="text-gray-400 hover:text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-crop" role="tab" tabindex="-1">
       Crop &amp; Rotate
      </button>
      <button aria-controls="text-panel" aria-selected="false" class="text-gray-400 hover:text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-text" role="tab" tabindex="-1">
       Add Text
      </button>
      <button aria-controls="draw-panel" aria-selected="false" class="text-gray-400 hover:text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-draw" role="tab" tabindex="-1">
       Draw &amp; Annotate
      </button>
      <button aria-controls="enhancements-panel" aria-selected="false" class="text-gray-400 hover:text-indigo-400 font-semibold whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500" id="tab-enhancements" role="tab" tabindex="-1">
       Enhancements
      </button>
     </nav>
     <!-- Panels -->
     <div class="flex-grow overflow-y-auto mt-4">
      <!-- Basic Adjustments Panel -->
      <section aria-labelledby="tab-basic" class="space-y-6" id="basic-adjustments-panel" role="tabpanel" tabindex="0">
       <div>
        <label class="block mb-1 font-medium" for="brightness">
         Brightness
        </label>
        <input aria-label="Adjust brightness" aria-valuemax="100" aria-valuemin="-100" aria-valuenow="0" class="w-full" id="brightness" max="100" min="-100" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="contrast">
         Contrast
        </label>
        <input aria-label="Adjust contrast" class="w-full" id="contrast" max="100" min="-100" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="saturation">
         Saturation
        </label>
        <input aria-label="Adjust saturation" class="w-full" id="saturation" max="100" min="-100" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="exposure">
         Exposure
        </label>
        <input aria-label="Adjust exposure" class="w-full" id="exposure" max="100" min="-100" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="highlights">
         Highlights
        </label>
        <input aria-label="Adjust highlights" class="w-full" id="highlights" max="100" min="-100" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="shadows">
         Shadows
        </label>
        <input aria-label="Adjust shadows" class="w-full" id="shadows" max="100" min="-100" type="range" value="0"/>
       </div>
      </section>
      <!-- Filters Panel -->
      <section aria-labelledby="tab-filters" class="hidden space-y-4" id="filters-panel" role="tabpanel" tabindex="0">
       <div class="flex space-x-4 overflow-x-auto no-scrollbar py-2">
        <button aria-label="Apply filter: Original" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="none">
         <img alt="Thumbnail preview of the original photo with no filter applied" class="w-20 h-20 object-cover rounded-md border-2 border-indigo-500" height="100" src="https://storage.googleapis.com/a1aa/image/68ff49f9-7d13-4750-a850-72ecb2077915.jpg" width="100"/>
         <span class="text-xs">
          Original
         </span>
        </button>
        <button aria-label="Apply filter: Sepia" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="sepia">
         <img alt="Thumbnail preview of the photo with sepia filter applied, showing warm brown tones" class="w-20 h-20 object-cover rounded-md" height="100" src="https://storage.googleapis.com/a1aa/image/06db1870-1ca2-4856-9399-6fbf0efbb90b.jpg" width="100"/>
         <span class="text-xs">
          Sepia
         </span>
        </button>
        <button aria-label="Apply filter: Grayscale" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="grayscale">
         <img alt="Thumbnail preview of the photo with grayscale filter applied, showing black and white tones" class="w-20 h-20 object-cover rounded-md" height="100" src="https://storage.googleapis.com/a1aa/image/cd2c2668-92b8-43b4-f226-5194967fd9c0.jpg" width="100"/>
         <span class="text-xs">
          Grayscale
         </span>
        </button>
        <button aria-label="Apply filter: Vintage" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="vintage">
         <img alt="Thumbnail preview of the photo with vintage filter applied, showing faded colors and warm tint" class="w-20 h-20 object-cover rounded-md" height="100" src="https://storage.googleapis.com/a1aa/image/51444c6b-7080-447b-0f47-0fcacc3f4e73.jpg" width="100"/>
         <span class="text-xs">
          Vintage
         </span>
        </button>
        <button aria-label="Apply filter: Cool" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="cool">
         <img alt="Thumbnail preview of the photo with cool filter applied, showing bluish tint" class="w-20 h-20 object-cover rounded-md" height="100" src="https://storage.googleapis.com/a1aa/image/e40637c1-590a-4e81-ad9f-f19ed904a936.jpg" width="100"/>
         <span class="text-xs">
          Cool
         </span>
        </button>
        <button aria-label="Apply filter: Warm" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded" data-filter="warm">
         <img alt="Thumbnail preview of the photo with warm filter applied, showing orange and red tint" class="w-20 h-20 object-cover rounded-md" height="100" src="https://storage.googleapis.com/a1aa/image/4283ea70-ff65-44cd-07e6-c1d6411da0ec.jpg" width="100"/>
         <span class="text-xs">
          Warm
         </span>
        </button>
       </div>
      </section>
      <!-- Crop & Rotate Panel -->
      <section aria-labelledby="tab-crop" class="hidden space-y-6" id="crop-rotate-panel" role="tabpanel" tabindex="0">
       <div>
        <label class="block mb-1 font-medium" for="crop-ratio">
         Crop Aspect Ratio
        </label>
        <select aria-label="Select crop aspect ratio" class="w-full rounded-md bg-gray-700 text-white p-2" id="crop-ratio">
         <option value="free">
          Free
         </option>
         <option value="1:1">
          1:1 (Square)
         </option>
         <option value="4:3">
          4:3
         </option>
         <option value="16:9">
          16:9
         </option>
         <option value="3:2">
          3:2
         </option>
        </select>
       </div>
       <div class="flex items-center space-x-4">
        <button aria-label="Rotate image left 90 degrees" class="flex items-center justify-center w-12 h-12 bg-gray-700 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="rotate-left" title="Rotate left">
         <i class="fas fa-undo text-xl">
         </i>
        </button>
        <button aria-label="Rotate image right 90 degrees" class="flex items-center justify-center w-12 h-12 bg-gray-700 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="rotate-right" title="Rotate right">
         <i class="fas fa-redo text-xl">
         </i>
        </button>
       </div>
       <div>
        <p class="text-sm text-gray-400">
         Use pinch or drag on the photo preview to adjust crop area.
        </p>
       </div>
      </section>
      <!-- Add Text Panel -->
      <section aria-labelledby="tab-text" class="hidden space-y-6" id="text-panel" role="tabpanel" tabindex="0">
       <div>
        <label class="block mb-1 font-medium" for="text-input">
         Enter Text
        </label>
        <input aria-label="Input text to add on photo" class="w-full rounded-md bg-gray-700 text-white p-2" id="text-input" placeholder="Type your text here" type="text"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="font-select">
         Font
        </label>
        <select aria-label="Select font for text" class="w-full rounded-md bg-gray-700 text-white p-2" id="font-select">
         <option value="Roboto">
          Roboto
         </option>
         <option value="Roboto Slab">
          Roboto Slab
         </option>
         <option value="Arial">
          Arial
         </option>
         <option value="Georgia">
          Georgia
         </option>
         <option value="Courier New">
          Courier New
         </option>
        </select>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="color-picker">
         Text Color
        </label>
        <input aria-label="Pick text color" class="w-16 h-10 p-0 border-0 rounded" id="color-picker" type="color" value="#ffffff"/>
       </div>
       <div>
        <button aria-label="Add text to photo" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" id="add-text-btn">
         Add Text
        </button>
       </div>
       <p class="text-sm text-gray-400">
        After adding, drag the text on the photo preview to reposition.
       </p>
      </section>
      <!-- Draw & Annotate Panel -->
      <section aria-labelledby="tab-draw" class="hidden space-y-6" id="draw-panel" role="tabpanel" tabindex="0">
       <div>
        <label class="block mb-1 font-medium" for="brush-size">
         Brush Size
        </label>
        <input aria-label="Adjust brush size" class="w-full" id="brush-size" max="30" min="1" type="range" value="5"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="brush-color">
         Brush Color
        </label>
        <input aria-label="Pick brush color" class="w-16 h-10 p-0 border-0 rounded" id="brush-color" type="color" value="#ffffff"/>
       </div>
       <div class="flex space-x-4">
        <button aria-label="Toggle drawing mode" aria-pressed="false" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" id="draw-mode-btn">
         Start Drawing
        </button>
        <button aria-label="Clear all drawings" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-red-500" id="clear-draw-btn">
         Clear Drawing
        </button>
       </div>
       <p class="text-sm text-gray-400">
        Use finger or mouse to draw on the photo preview.
       </p>
      </section>
      <!-- Enhancements Panel -->
      <section aria-labelledby="tab-enhancements" class="hidden space-y-6" id="enhancements-panel" role="tabpanel" tabindex="0">
       <div>
        <label class="block mb-1 font-medium" for="sharpen">
         Sharpen
        </label>
        <input aria-label="Adjust sharpening" class="w-full" id="sharpen" max="100" min="0" type="range" value="0"/>
       </div>
       <div>
        <label class="block mb-1 font-medium" for="blur">
         Blur
        </label>
        <input aria-label="Adjust blurring" class="w-full" id="blur" max="100" min="0" type="range" value="0"/>
       </div>
      </section>
     </div>
     <!-- Save Button -->
     <div class="pt-4 border-t border-gray-700 flex justify-center">
      <button aria-label="Save edited photo to device" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded shadow-lg focus:outline-none focus:ring-4 focus:ring-green-500" id="save-btn">
       <i class="fas fa-download mr-2">
       </i>
       Save Photo
      </button>
     </div>
    </div>
   </section>
  </div>
  <script>
   // This script sets up the tab switching and basic UI interactions.
    // Camera and editing functionality would be implemented separately.

    const tabs = document.querySelectorAll('#edit-tabs button');
    const panels = document.querySelectorAll('[role="tabpanel"]');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        // Deselect all tabs
        tabs.forEach((t) => {
          t.setAttribute('aria-selected', 'false');
          t.classList.remove('text-indigo-400');
          t.classList.add('text-gray-400');
          t.setAttribute('tabindex', '-1');
        });
        // Hide all panels
        panels.forEach((panel) => {
          panel.classList.add('hidden');
        });

        // Select clicked tab
        tab.setAttribute('aria-selected', 'true');
        tab.classList.remove('text-gray-400');
        tab.classList.add('text-indigo-400');
        tab.setAttribute('tabindex', '0');

        // Show associated panel
        const panel = document.getElementById(tab.getAttribute('aria-controls'));
        if (panel) {
          panel.classList.remove('hidden');
          panel.focus();
        }
      });
    });

    // Accessibility: allow arrow keys to navigate tabs
    document.getElementById('edit-tabs').addEventListener('keydown', (e) => {
      const currentIndex = Array.from(tabs).findIndex(
        (tab) => tab.getAttribute('aria-selected') === 'true'
      );
      let newIndex = currentIndex;
      if (e.key === 'ArrowRight') {
        newIndex = (currentIndex + 1) % tabs.length;
        e.preventDefault();
      } else if (e.key === 'ArrowLeft') {
        newIndex = (currentIndex - 1 + tabs.length) % tabs.length;
        e.preventDefault();
      }
      if (newIndex !== currentIndex) {
        tabs[newIndex].click();
        tabs[newIndex].focus();
      }
    });

    // Show camera view on load
    const cameraView = document.getElementById('camera-view');
    const photoPreview = document.getElementById('photo-preview');
    const video = document.getElementById('video');
    const captureBtn = document.getElementById('capture-btn');
    const closePreviewBtn = document.getElementById('close-preview');
    const capturedPhoto = document.getElementById('captured-photo');
    const flashBtn = document.getElementById('flash-btn');
    const flashModeSpan = document.getElementById('flash-mode');
    const zoomLevel = document.getElementById('zoom-level');

    let flashModes = ['auto', 'on', 'off'];
    let currentFlashIndex = 0;

    // Flash button toggle
    flashBtn.addEventListener('click', () => {
      currentFlashIndex = (currentFlashIndex + 1) % flashModes.length;
      flashModeSpan.textContent = flashModes[currentFlashIndex].charAt(0).toUpperCase() + flashModes[currentFlashIndex].slice(1);
      flashBtn.title = `Flash: ${flashModeSpan.textContent}`;
    });

    // Placeholder zoom level (1x)
    let zoom = 1;
    zoomLevel.textContent = zoom + 'x';

    // Pinch to zoom and tap to focus would require camera API and gesture handling (not implemented here)

    // Open camera stream
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' },
          audio: false,
        });
        video.srcObject = stream;
      } catch (err) {
        alert('Error accessing camera: ' + err.message);
      }
    }

    startCamera();

    // Capture photo
    captureBtn.addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const dataUrl = canvas.toDataURL('image/png');
      capturedPhoto.src = dataUrl;
      capturedPhoto.alt = 'Captured photo preview showing the image just taken by the camera';
      cameraView.classList.add('hidden');
      photoPreview.classList.remove('hidden');
      // Reset editing controls (not implemented here)
    });

    // Close preview and return to camera
    closePreviewBtn.addEventListener('click', () => {
      photoPreview.classList.add('hidden');
      cameraView.classList.remove('hidden');
    });

    // Save photo button
    const saveBtn = document.getElementById('save-btn');
    saveBtn.addEventListener('click', () => {
      // For demo: download the current image src
      const link = document.createElement('a');
      link.href = capturedPhoto.src;
      link.download = 'edited-photo.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // Drawing on photo preview canvas overlay (basic implementation)
    const drawPanel = document.getElementById('draw-panel');
    const drawModeBtn = document.getElementById('draw-mode-btn');
    const clearDrawBtn = document.getElementById('clear-draw-btn');
    const brushSizeInput = document.getElementById('brush-size');
    const brushColorInput = document.getElementById('brush-color');

    // Create a canvas overlay on top of the captured photo for drawing
    const photoContainer = capturedPhoto.parentElement;
    const drawCanvas = document.createElement('canvas');
    drawCanvas.style.position = 'absolute';
    drawCanvas.style.top = '0';
    drawCanvas.style.left = '0';
    drawCanvas.style.width = '100%';
    drawCanvas.style.height = '100%';
    drawCanvas.style.touchAction = 'none';
    drawCanvas.style.cursor = 'crosshair';
    drawCanvas.width = 0;
    drawCanvas.height = 0;
    drawCanvas.classList.add('pointer-events-none');
    photoContainer.style.position = 'relative';
    photoContainer.appendChild(drawCanvas);

    const ctx = drawCanvas.getContext('2d');
    let drawing = false;
    let drawMode = false;

    function resizeCanvas() {
      drawCanvas.width = capturedPhoto.clientWidth;
      drawCanvas.height = capturedPhoto.clientHeight;
      drawCanvas.style.width = capturedPhoto.clientWidth + 'px';
      drawCanvas.style.height = capturedPhoto.clientHeight + 'px';
    }

    window.addEventListener('resize', resizeCanvas);
    capturedPhoto.addEventListener('load', resizeCanvas);

    function getPointerPos(e) {
      const rect = drawCanvas.getBoundingClientRect();
      let x, y;
      if (e.touches) {
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
      } else {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
      }
      return { x, y };
    }

    drawCanvas.addEventListener('pointerdown', (e) => {
      if (!drawMode) return;
      drawing = true;
      const pos = getPointerPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
      e.preventDefault();
    });

    drawCanvas.addEventListener('pointermove', (e) => {
      if (!drawing) return;
      const pos = getPointerPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.strokeStyle = brushColorInput.value;
      ctx.lineWidth = brushSizeInput.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.stroke();
      e.preventDefault();
    });

    drawCanvas.addEventListener('pointerup', () => {
      if (!drawMode) return;
      drawing = false;
    });
    drawCanvas.addEventListener('pointerleave', () => {
      if (!drawMode) return;
      drawing = false;
    });

    drawModeBtn.addEventListener('click', () => {
      drawMode = !drawMode;
      drawModeBtn.textContent = drawMode ? 'Stop Drawing' : 'Start Drawing';
      drawModeBtn.setAttribute('aria-pressed', drawMode.toString());
      drawCanvas.classList.toggle('pointer-events-auto', drawMode);
      drawCanvas.classList.toggle('pointer-events-none', !drawMode);
    });

    clearDrawBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
    });

    // Add Text functionality (basic)
    const addTextBtn = document.getElementById('add-text-btn');
    const textInput = document.getElementById('text-input');
    const fontSelect = document.getElementById('font-select');
    const colorPicker = document.getElementById('color-picker');

    // Container for text overlays
    const textOverlayContainer = document.createElement('div');
    textOverlayContainer.style.position = 'absolute';
    textOverlayContainer.style.top = '0';
    textOverlayContainer.style.left = '0';
    textOverlayContainer.style.width = '100%';
    textOverlayContainer.style.height = '100%';
    textOverlayContainer.style.pointerEvents = 'none';
    photoContainer.appendChild(textOverlayContainer);

    addTextBtn.addEventListener('click', () => {
      if (!textInput.value.trim()) return;
      const textEl = document.createElement('div');
      textEl.textContent = textInput.value.trim();
      textEl.style.position = 'absolute';
      textEl.style.top = '50%';
      textEl.style.left = '50%';
      textEl.style.transform = 'translate(-50%, -50%)';
      textEl.style.color = colorPicker.value;
      textEl.style.fontFamily = fontSelect.value;
      textEl.style.fontSize = '24px';
      textEl.style.fontWeight = 'bold';
      textEl.style.pointerEvents = 'auto';
      textEl.style.cursor = 'move';
      textEl.style.userSelect = 'none';
      textEl.setAttribute('tabindex', '0');
      textOverlayContainer.appendChild(textEl);

      // Make text draggable
      let isDragging = false;
      let startX, startY, origX, origY;

      function onPointerDown(e) {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = textEl.getBoundingClientRect();
        origX = rect.left;
        origY = rect.top;
        e.preventDefault();
      }
      function onPointerMove(e) {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const parentRect = photoContainer.getBoundingClientRect();
        let newLeft = origX + dx - parentRect.left;
        let newTop = origY + dy - parentRect.top;
        // Clamp inside container
        newLeft = Math.min(
          Math.max(newLeft, 0),
          photoContainer.clientWidth - textEl.offsetWidth
        );
        newTop = Math.min(
          Math.max(newTop, 0),
          photoContainer.clientHeight - textEl.offsetHeight
        );
        textEl.style.left = newLeft + 'px';
        textEl.style.top = newTop + 'px';
        textEl.style.transform = 'translate(0, 0)';
      }
      function onPointerUp() {
        isDragging = false;
      }

      textEl.addEventListener('pointerdown', onPointerDown);
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);

      // Clear input after adding
      textInput.value = '';
    });

    // Crop & Rotate placeholders (no actual crop/rotate logic implemented)
    const rotateLeftBtn = document.getElementById('rotate-left');
    const rotateRightBtn = document.getElementById('rotate-right');
    let rotation = 0;

    rotateLeftBtn.addEventListener('click', () => {
      rotation -= 90;
      capturedPhoto.style.transform = `rotate(${rotation}deg)`;
      textOverlayContainer.style.transform = `rotate(${rotation}deg)`;
      drawCanvas.style.transform = `rotate(${rotation}deg)`;
    });
    rotateRightBtn.addEventListener('click', () => {
      rotation += 90;
      capturedPhoto.style.transform = `rotate(${rotation}deg)`;
      textOverlayContainer.style.transform = `rotate(${rotation}deg)`;
      drawCanvas.style.transform = `rotate(${rotation}deg)`;
    });

    // Basic adjustments, filters, enhancements would require canvas pixel manipulation or CSS filters
    // For demonstration, we apply CSS filters on the capturedPhoto image

    const brightnessInput = document.getElementById('brightness');
    const contrastInput = document.getElementById('contrast');
    const saturationInput = document.getElementById('saturation');
    const exposureInput = document.getElementById('exposure');
    const highlightsInput = document.getElementById('highlights');
    const shadowsInput = document.getElementById('shadows');
    const sharpenInput = document.getElementById('sharpen');
    const blurInput = document.getElementById('blur');

    const filterButtons = document.querySelectorAll('[data-filter]');

    let currentFilter = 'none';

    function updateFilters() {
      // Convert slider values to CSS filter values
      const brightness = 1 + brightnessInput.value / 100;
      const contrast = 1 + contrastInput.value / 100;
      const saturation = 1 + saturationInput.value / 100;
      const exposure = 1 + exposureInput.value / 100;
      // highlights and shadows are complex, approximate with brightness adjustments
      const highlights = 1 + highlightsInput.value / 200;
      const shadows = 1 + shadowsInput.value / 200;
      const sharpen = sharpenInput.value / 100;
      const blur = blurInput.value / 20;

      // Compose CSS filter string
      let filterStr = `brightness(${brightness * exposure * highlights * shadows}) contrast(${contrast}) saturate(${saturation})`;

      // Apply selected filter overlay
      switch (currentFilter) {
        case 'sepia':
          filterStr += ' sepia(0.6)';
          break;
        case 'grayscale':
          filterStr += ' grayscale(1)';
          break;
        case 'vintage':
          filterStr += ' sepia(0.4) contrast(0.9) saturate(0.7)';
          break;
        case 'cool':
          filterStr += ' hue-rotate(180deg) saturate(1.2)';
          break;
        case 'warm':
          filterStr += ' hue-rotate(-20deg) saturate(1.3)';
          break;
        default:
          break;
      }

      if (sharpen > 0) {
        // CSS does not have sharpen filter, so skip or use drop shadow hack (not implemented)
      }
      if (blur > 0) {
        filterStr += ` blur(${blur}px)`;
      }

      capturedPhoto.style.filter = filterStr;
    }

    [
      brightnessInput,
      contrastInput,
      saturationInput,
      exposureInput,
      highlightsInput,
      shadowsInput,
      sharpenInput,
      blurInput,
    ].forEach((input) => {
      input.addEventListener('input', updateFilters);
    });

    filterButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        currentFilter = btn.getAttribute('data-filter');
        filterButtons.forEach((b) => b.classList.remove('border-indigo-500'));
        btn.classList.add('border-indigo-500');
        updateFilters();
      });
    });

    // Initialize filter selection highlight
    filterButtons[0].classList.add('border-indigo-500');
  </script>
 </body>
</html>
